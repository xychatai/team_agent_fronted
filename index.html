<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>团队邀请系统 - 用户端</title>
    <link href="https://cdn.jsdelivr.net/npm/element-plus@2.3.7/dist/index.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>团队邀请系统</h1>
            <p>超越想象，GPT-5 Plus为你的设计修图增添无限灵感！</p>
        </div>
        
        <div class="container">
            <el-tabs v-model="activeTab" class="tabs-container" @tab-change="handleTabChange">
                <!-- 兑换码兑换 -->
                <el-tab-pane name="redeem">
                    <template #label>
                        <div class="tab-label">
                            <el-icon><CreditCard /></el-icon>
                            <span>兑换</span>
                        </div>
                    </template>
                    <div class="tab-content">
                        <div class="feature-card redeem-card">
                            <div class="card-header">
                                <div class="card-icon redeem-icon">
                                    <el-icon size="28"><CreditCard /></el-icon>
                                </div>
                                <div class="card-title">兑换码使用</div>
                                <div class="card-desc">超越想象，GPT-5 Plus为你的设计修图增添无限灵感！</div>
                            </div>
                            <div class="card-body">
                                <el-form :model="redeemForm" :rules="redeemRules" ref="redeemFormRef" size="large">
                                    <el-form-item prop="code">
                                        <el-input 
                                            v-model="redeemForm.code" 
                                            placeholder="请输入您的兑换码"
                                            class="input-field"
                                            clearable>
                                            <template #prefix>
                                                <el-icon><Ticket /></el-icon>
                                            </template>
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item prop="email">
                                        <el-input 
                                            v-model="redeemForm.email" 
                                            placeholder="请输入您的邮箱地址"
                                            class="input-field"
                                            clearable>
                                            <template #prefix>
                                                <el-icon><User /></el-icon>
                                            </template>
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button 
                                            type="primary" 
                                            size="large"
                                            class="action-button"
                                            @click="handleRedeem"
                                            :loading="loading.redeem">
                                            <el-icon v-if="!loading.redeem"><Check /></el-icon>
                                            立即兑换
                                        </el-button>
                                    </el-form-item>
                                </el-form>
                                
                                <div v-if="redeemResult" :class="['result-panel', redeemResult.success ? 'success-panel' : 'error-panel']">
                                    <div v-if="redeemResult.success" class="success-content">
                                        <div class="result-icon">
                                            <el-icon size="48" color="#67c23a"><SuccessFilled /></el-icon>
                                        </div>
                                        <div class="result-title">兑换成功！</div>
                                        <div class="result-message" v-text="redeemResult.message"></div>
                                        <div v-if="redeemResult.bind_type === 'warranty'" class="warranty-info">
                                            <el-tag type="warning" size="large">
                                                质保期：<span v-text="redeemResult.warranty_days"></span>天
                                            </el-tag>
                                        </div>
                                        <div class="next-step">
                                            <strong>📧 请检查您的邮箱并接受团队邀请</strong>
                                        </div>
                                    </div>
                                    <div v-else class="error-content">
                                        <div class="result-icon">
                                            <el-icon size="48" color="#f56c6c"><CircleCloseFilled /></el-icon>
                                        </div>
                                        <div class="result-title">兑换失败</div>
                                        <div class="result-message" v-text="redeemResult.error"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
                
                <!-- 解绑功能 -->
                <el-tab-pane name="unbind">
                    <template #label>
                        <div class="tab-label">
                            <el-icon><Connection /></el-icon>
                            <span>解绑</span>
                        </div>
                    </template>
                    <div class="tab-content">
                        <div class="feature-card unbind-card">
                            <div class="card-header">
                                <div class="card-icon unbind-icon">
                                    <el-icon size="28"><Connection /></el-icon>
                                </div>
                                <div class="card-title">解绑管理</div>
                                <div class="card-desc">解绑当前兑换码，释放重复使用资格</div>
                            </div>
                            <div class="card-body">
                                <el-form :model="unbindForm" :rules="unbindRules" ref="unbindFormRef" size="large">
                                    <el-form-item prop="email">
                                        <el-input 
                                            v-model="unbindForm.email" 
                                            placeholder="请输入您的邮箱地址"
                                            class="input-field"
                                            clearable>
                                            <template #prefix>
                                                <el-icon><User /></el-icon>
                                            </template>
                                        </el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button 
                                            type="primary" 
                                            size="large"
                                            class="action-button"
                                            @click="handleCheckStatus"
                                            :loading="loading.status">
                                            <el-icon v-if="!loading.status"><View /></el-icon>
                                            查询绑定状态
                                        </el-button>
                                    </el-form-item>
                                </el-form>
                                
                                <div v-if="statusResult" class="status-panel">
                                    <div class="binding-info">
                                        <el-descriptions :column="1" border size="large">
                                            <el-descriptions-item label="绑定状态">
                                                <el-tag :type="statusResult.has_binding ? 'success' : 'info'" size="large">
                                                    <span v-text="statusResult.has_binding ? '已绑定' : '未绑定'"></span>
                                                </el-tag>
                                            </el-descriptions-item>
                                            <el-descriptions-item v-if="statusResult.binding" label="兑换码">
                                                <code class="code-display" v-text="statusResult.binding.redemption_code"></code>
                                            </el-descriptions-item>
                                            <el-descriptions-item v-if="statusResult.binding" label="母号邮箱">
                                                <span v-text="statusResult.binding.mother_email"></span>
                                            </el-descriptions-item>
                                            <el-descriptions-item v-if="statusResult.binding" label="绑定类型">
                                                <el-tag :type="statusResult.binding.type === 'warranty' ? 'warning' : 'info'" size="large">
                                                    <span v-text="statusResult.binding.type === 'warranty' ? '质保型' : '一次性'"></span>
                                                </el-tag>
                                            </el-descriptions-item>
                                            <el-descriptions-item v-if="statusResult.binding && statusResult.binding.remaining_days !== undefined" label="剩余质保天数">
                                                <span v-text="statusResult.binding.remaining_days"></span>天
                                            </el-descriptions-item>
                                        </el-descriptions>
                                        
                                        <div v-if="statusResult.binding && statusResult.binding.status === 'active'" class="unbind-actions">
                                            <el-button 
                                                type="danger" 
                                                size="large"
                                                class="unbind-button"
                                                @click="handleUnbind"
                                                :loading="loading.unbind">
                                                <el-icon v-if="!loading.unbind"><Minus /></el-icon>
                                                解绑此兑换码
                                            </el-button>
                                            <div class="unbind-tips">
                                                <el-alert 
                                                    :type="statusResult.binding.type === 'warranty' ? 'success' : 'warning'" 
                                                    :closable="false"
                                                    show-icon>
                                                    <template v-if="statusResult.binding.type === 'warranty'">
                                                        ✅ 质保型卡密解绑后可以重新使用
                                                    </template>
                                                    <template v-else>
                                                        ⚠️ 一次性卡密在母号活跃时可解绑并重新使用，母号封禁时无法解绑
                                                    </template>
                                                </el-alert>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
                
                <!-- 使用说明 -->
                <el-tab-pane name="help">
                    <template #label>
                        <div class="tab-label">
                            <el-icon><InfoFilled /></el-icon>
                            <span>使用说明</span>
                        </div>
                    </template>
                    <div class="tab-content">
                        <div class="feature-card help-card">
                            <div class="card-header">
                                <div class="card-icon help-icon">
                                    <el-icon size="28"><InfoFilled /></el-icon>
                                </div>
                                <div class="card-title">使用说明</div>
                                <div class="card-desc">了解如何使用团队邀请系统</div>
                            </div>
                            <div class="card-body">
                                <div v-if="loading.help" class="loading-help">
                                    <el-skeleton :rows="8" animated />
                                </div>
                                <div v-else-if="helpContent && helpContent.length > 0" class="help-content" v-html="helpContent"></div>
                                <div v-else class="default-help">
                                    <el-alert 
                                        type="info" 
                                        :closable="false"
                                        style="margin-bottom: 20px;">
                                        <template #default>
                                            <strong>提示：</strong>正在显示默认使用说明。管理员可在后台上传自定义帮助文档。
                                        </template>
                                    </el-alert>
                                    <div class="help-section">
                                        <h3>🎫 什么是兑换码？</h3>
                                        <p>兑换码是您加入ChatGPT团队的通行证，每个兑换码对应一个团队席位。</p>
                                    </div>
                                    <div class="help-section">
                                        <h3>🔄 解绑功能说明</h3>
                                        <p><strong>质保型卡密：</strong>解绑后可以重新使用，适合需要更换邮箱的用户。</p>
                                        <p><strong>一次性卡密：</strong>仅在母号活跃时可解绑重用，母号封禁后无法解绑。</p>
                                    </div>
                                    <div class="help-section">
                                        <h3>🛡️ 质保服务</h3>
                                        <p>质保型卡密提供质保期保障，母号失效时可申请免费替换，确保您的团队访问权限。</p>
                                    </div>
                                    <div class="help-section">
                                        <h3>📧 使用流程</h3>
                                        <ol>
                                            <li>在"兑换"页面输入兑换码和邮箱</li>
                                            <li>等待系统发送团队邀请邮件</li>
                                            <li>查收邮箱并接受团队邀请</li>
                                            <li>开始使用ChatGPT团队功能</li>
                                        </ol>
                                    </div>
                                    <div class="help-section">
                                        <h3>❓ 常见问题</h3>
                                        <p><strong>Q: 没收到邀请邮件怎么办？</strong><br>
                                        A: 请检查垃圾邮箱，或联系客服重新发送邀请。</p>
                                        <p><strong>Q: 可以更换邮箱吗？</strong><br>
                                        A: 质保型卡密支持解绑重用，一次性卡密需母号活跃才能解绑。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </div>
    </div>

    <!-- 依赖脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.3.7/dist/index.full.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.3.7/dist/locale/zh-cn.js"></script>
    
    <!-- 配置文件 -->
    <script src="config/api-config.js"></script>
    
    <!-- 应用脚本 -->
    <script src="assets/js/api.js"></script>
    <script src="assets/js/main.js"></script>
    
</body>
</html>